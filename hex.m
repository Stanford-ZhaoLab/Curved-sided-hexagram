%% Dimensionless governing equation systems
% x denote the 13 variables, and y denote their first derivatives 
% F1, F2, F3, k1, k2, k3, r1, r2, r3, q0, q1, q2, q3
function y = tri(x, p)
global a b k1 k2 l1 l2 M1

%The first sigment
x1 = x(1,:);
x2 = x(2,:);
x3 = x(3,:);
x4 = x(4,:);
x5 = x(5,:);
x6 = x(6,:);
x7 = x(7,:);
x8 = x(8,:);
x9 = x(9,:);
x10 = x(10,:);
x11 = x(11,:); 
x12 = x(12,:);
x13 = x(13,:);

y(1,:) = 2*pi*(x2.*x6 - x3.*x5);
y(2,:) = 2*pi*(x3.*x4 - x1.*x6);
y(3,:) = 2*pi*(x1.*x5 - x2.*x4);
y(4,:) = 1/a*x2/(2*pi) + 2*pi*(b/a-1/a)*x5.*x6;
y(5,:) = -1/b*x1/(2*pi) - 2*pi*(a/b-1/b)*x4.*x6 + 2*pi*k1*a/b*x6-M1*x6/b;
y(6,:) = 2*pi*(a-b)*x4.*x5 - 2*pi*k1*a*x5+M1*x5;
y(7,:) = 2*(x11.*x13 + x10.*x12);
y(8,:) = 2*(x12.*x13 - x10.*x11);
y(9,:) = 2*(x10.^2 + x13.^2 - 1/2);
y(10,:) = pi*(-x11.*x4 - x12.*x5 - x13.*x6);
y(11,:) = pi*(x10.*x4 - x13.*x5 + x12.*x6);
y(12,:) = pi*(x13.*x4 + x10.*x5 - x11.*x6);
y(13,:) = pi*(-x12.*x4 + x11.*x5 + x10.*x6);

y(1:13,:) = y(1:13,:)*(0.5*l1);

% The second segment
x14 = x(14,:);
x15 = x(15,:);
x16 = x(16,:);
x17 = x(17,:);
x18 = x(18,:);
x19 = x(19,:);
x20 = x(20,:);
x21 = x(21,:);
x22 = x(22,:);
x23 = x(23,:);
x24 = x(24,:);
x25 = x(25,:);
x26 = x(26,:);

y(14,:) = 2*pi*(x15.*x19 - x16.*x18);
y(15,:) = 2*pi*(x16.*x17 - x14.*x19);
y(16,:) = 2*pi*(x14.*x18 - x15.*x17);
y(17,:) = 1/a*x15/(2*pi) + 2*pi*(b/a-1/a)*x18.*x19;
y(18,:) = -1/b*x14/(2*pi) - 2*pi*(a/b-1/b)*x17.*x19 + 2*pi*k2*a/b*x19-M1*x19/b;
y(19,:) = 2*pi*(a-b)*x17.*x18 - 2*pi*k2*a*x18+M1*x18;
y(20,:) = 2*(x24.*x26 + x23.*x25);
y(21,:) = 2*(x25.*x26 - x23.*x24);
y(22,:) = 2*(x23.^2 + x26.^2 - 1/2);
y(23,:) = pi*(-x24.*x17 - x25.*x18 - x26.*x19);
y(24,:) = pi*(x23.*x17 - x26.*x18 + x25.*x19);
y(25,:) = pi*(x26.*x17 + x23.*x18 - x24.*x19);
y(26,:) = pi*(-x25.*x17 + x24.*x18 + x23.*x19);

y(14:26,:) = y(14:26,:)*l2;

% The third segment
x27 = x(27,:);
x28 = x(28,:);
x29 = x(29,:);
x30 = x(30,:);
x31 = x(31,:);
x32 = x(32,:);
x33 = x(33,:);
x34 = x(34,:);
x35 = x(35,:);
x36 = x(36,:);
x37 = x(37,:);
x38 = x(38,:);
x39 = x(39,:);

y(27,:) = 2*pi*(x28.*x32 - x29.*x31);
y(28,:) = 2*pi*(x29.*x30 - x27.*x32);
y(29,:) = 2*pi*(x27.*x31 - x28.*x30);
y(30,:) = 1/a*x28/(2*pi) + 2*pi*(b/a-1/a)*x31.*x32;
y(31,:) = -1/b*x27/(2*pi) - 2*pi*(a/b-1/b)*x30.*x32 + 2*pi*k1*a/b*x32-M1*x32/b;
y(32,:) = 2*pi*(a-b)*x30.*x31 - 2*pi*k1*a*x31+M1*x31;
y(33,:) = 2*(x37.*x39 + x36.*x38);
y(34,:) = 2*(x38.*x39 - x36.*x37);
y(35,:) = 2*(x36.^2 + x39.^2 - 1/2);
y(36,:) = pi*(-x37.*x30 - x38.*x31 - x39.*x32);
y(37,:) = pi*(x36.*x30 - x39.*x31 + x38.*x32);
y(38,:) = pi*(x39.*x30 + x36.*x31 - x37.*x32);
y(39,:) = pi*(-x38.*x30 + x37.*x31 + x36.*x32);

y(27:39,:) = y(27:39,:)*l1;

% The fourth segment
x40 = x(40,:);
x41 = x(41,:);
x42 = x(42,:);
x43 = x(43,:);
x44 = x(44,:);
x45 = x(45,:);
x46 = x(46,:);
x47 = x(47,:);
x48 = x(48,:);
x49 = x(49,:);
x50 = x(50,:);
x51 = x(51,:);
x52 = x(52,:);

y(40,:) = 2*pi*(x41.*x45 - x42.*x44);
y(41,:) = 2*pi*(x42.*x43 - x40.*x45);
y(42,:) = 2*pi*(x40.*x44 - x41.*x43);
y(43,:) = 1/a*x41/(2*pi) + 2*pi*(b/a-1/a)*x44.*x45;
y(44,:) = -1/b*x40/(2*pi) - 2*pi*(a/b-1/b)*x43.*x45 + 2*pi*k2*a/b*x45-M1*x45/b;
y(45,:) = 2*pi*(a-b)*x43.*x44 - 2*pi*k2*a*x44+M1*x44;
y(46,:) = 2*(x50.*x52 + x49.*x51);
y(47,:) = 2*(x51.*x52 - x49.*x50);
y(48,:) = 2*(x49.^2 + x52.^2 - 1/2);
y(49,:) = pi*(-x50.*x43 - x51.*x44 - x52.*x45);
y(50,:) = pi*(x49.*x43 - x52.*x44 + x51.*x45);
y(51,:) = pi*(x52.*x43 + x49.*x44 - x50.*x45);
y(52,:) = pi*(-x51.*x43 + x50.*x44 + x49.*x45);

y(40:52,:) = y(40:52,:)*(0.5*l2);
end
